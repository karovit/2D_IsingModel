# 2D_IsingModel
# 1. Физический подход
Модель Изинга была разработана для объяснения механизмов ферромагнетизма и сыграла ключевую роль в исследовании критических явлений и фазовых переходов. Ферромагнитные материалы обладают способностью к спонтанной намагниченности при температурах ниже критической — так называемой точки Кюри. Вблизи этой температуры происходит резкое упорядочение магнитных моментов, сопровождающееся фазовым переходом, при котором макроскопические свойства вещества изменяются скачкообразно. 

В рамках модели рассматривается система, которая состоит из атомов со спинами $1/2$, расположенными в узлах кристаллической решетки,с учетом взаимодействия лишь между ближайшими соседями. Спиновое взаимодействие между узлами $i$ и $j$ описывается следующим выражением:
>$$ 
\begin{equation}
V(i,j) = 
    \begin{cases}
    -J\sigma_i\sigma_j, \ between \  neighbours
    \\
    0, \ else
    \end{cases}
\end{equation} 
$$

Где $J$ - энергия взаимодействия соседних пар, $\sigma = \{+1,-1\}$ - удвоенная проекция спина атома на ось.
При этом $J$ > 0 описывает поведение ферромагнетика, $J$ < 0 антиферромагнетика.

<img src="https://github.com/karovit/2D_IsingModel/blob/main/images/scheme.png" width="400" /> <img src="https://github.com/karovit/2D_IsingModel/blob/main/images/magn.jpg" width="400" />

Таким образом, спин-спиновая энергия системы
N атомов в узлах квадратной решетки записывается в виде:
>$$
>E = -J\sum _{i,j}^N \sigma_i \sigma_j
$$

Если поместить систему во внешнее магнитное поле $H$, то полная энергия примет вид:
>$$
E = -J\sum _{i,j}^N \sigma_i \sigma_j \ -H\sum_i^N\sigma_i
$$

Суммирование ведется по всем парам соседних узлов. Каждая связь при этом считается один раз. . Поскольку каждый спин может принимать только два значения, мы получаем $2^N$ различных конфигураций нашей системы. При этом каждому состоянию соответствует собственная энергия. 

Для нахождения термодинамических характеристик такой системы определяется статистическая сумма $Z$ такой системы:
>$$
Z = \sum_{all\ states} e ^ {-\beta E}
$$

,где $\beta = 1/T$ и суммирование ведется по всем состояниям

Далее, определяется свободная энергия из равенств для свободной энергии $F = -T\ln Z$ и $F = U - TS$ можно определить энтропию $S$ и теплоемкость $C$ системы:

>$$
S = \left( \frac{\partial F}{\partial T} \right)_V; \ C = T \left( \frac{\partial S}{\partial T} \right)_V
$$

# 2. Применение модели Изинга для анализа поведения пользователей

В современных цифровых продуктах ключевую роль играет коллективное поведение пользователей: распространение информации, принятие решений, формирование трендов. Модель Изинга можно использовать для описания взаимодействия пользователей с продуктом (мобильным приложением или платформой) и друг с другом. 

## Состояния агентов(пользователей) $\sigma$ носит бинарный характер: 
1) $\sigma = +1$ - пользователь совершает целевое действие (покупка, активное использование);
2) $\sigma = -1$ - пользователь неактивен или ушел.

## Взаимодействие пользователей $J_{ij}$
1) $J_{ij} > 0$ - пользователи $i$ и $j$ влияют друг на друга положительно.
Например, друзья в соцсети чаще покупают товар, если видят, что другие его купили.

2) $J_{ij} < 0$ - негативное влияние.

3) $J_{ij} = 0$ - пользователи не влияют друг на друга.

## Энергия системы H
В модели Изинга энергия системы $H$ отражает степень согласованности поведения пользователей и их реакции на внешние воздействия. Чем ниже энергия, тем более устойчивое и предсказуемое состояние у системы. Разделим Гамильтониан системы на следующие компоненты:

1) Часть, описывающая взаимодействие пользователей друг с другом:

$H_{int} = - \sum _{i,j} J _{ij} \sigma _i \sigma _j$ - чем больше пользователей в одинаковом состоянии, тем ниже энергия

2) Слагаемое, описывающее внешнее влияние (в физике - магнитное поле)

$H_{ext} = - \sum _{i} h _{i} \sigma _i $

$h_i > 0$ - внешние факторы подталкивают пользователя к использованию продукта (например, реклама или другие фичи);  $h_i < 0$ - факторы, снижающие активность пользователя (высокая стоимость продукта, неудобное приложение или плохой дизайн)

Тогда полная энергия системы:
> $H = H_{int} + H_{ext} = - \sum _{i,j} J _{ij} \sigma _i \sigma _j - \sum _{i} h _{i} \sigma _i$

## Температура $T$
Будем интерпретировать температуру системы $T$, как некий параметр, характеризующий степень случайности в принятии решений агентами (пользователями). Это связано с тем , что, согласно основным результатам теории статистической физики, вероятность нахождения системы в конкретном состоянии  $P \propto e^{-H/T}$.
Тогда, вероятность перехода:
> $P \propto e^{-\Delta H / T}$

Можно заметить, что данное выражение имеет следующую интерпретацию:
1) При малых $T$ пользователи ведут себя детерминированно и активно подстраиваются под мнение большинства.
2) При $T >> 1$ имеет место случайность.

# 3. Алгоритм Метрополиса-Гастингса
Всего возможно $2^N$ состояний и при достаточно большом числе спинов трудно получить численные результаты. Для моделирования используется статистический подход, в котором система рассматривается в состоянии термодинамического равновесия при определенной температуре $T$. В ходе обмена энергией с окружающей средой, энергия будет флуктуировать около равновесного состояния.

## Шаги алгоритма
1) Инициализация - задаем начальное состояние всех агентов $\sigma _1, ..., \sigma _N$ при фиксированной температуре $T$
2) Случайно выбираем агента $i$ и меняем его состояние: $\sigma _i \rightarrow - \sigma _i$.
3) Вычисляем изменение энергии $\Delta H$ и принимаем изменение с вероятностью $P = min(1, e^{-\Delta H/T})$
4) Повторяем шаги для многих итераций

Исходная конфигурация системы часто далека от баланса. Метод Метрополиса позволяет достичь устойчивого распределения за ограниченное количество циклов, избегая перебора всех возможных вариантов (которых экспоненциально много - $2^N$). Обычно хватает порядка 10N шагов для достижения приемлемой точности.

<img src="https://github.com/karovit/2D_IsingModel/blob/main/images/monte_%20carlo.jpg" width="400" />

Термодинамические параметры вычисляются в состоянии равновесия:
> $\left\langle A \right\rangle=\lim _{n\to \infty } \left( \frac{1}{n}\sum _i ^N A_i \right)$

# 4. Анализ результатов

Моделирование проводилось для простейшего классического случая модели Изинга без учета внешнего воздействия ($h_i = 0$), что соответствует отсутствию явных принудительных стимулов (например, рекламных кампаний). Это связано с тем, что интересно изучить естественную динамику системы, обусловленную только внутренними взаимодействиями между агентами (пользователями).

Также, для простоты предполагается, что влияние пользователей друг на друга однородно и локализовано в пределах ближайшего «окружения» (т.е. взаимодействие происходит только между соседними узлами решетки, $J_{ij} = const$). 
